<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Assistente Virtual de Sa√∫de ‚Äî UBS</title>
<link rel="icon" href="data:,">
<style>
:root{
  --bg:#f8fafc; /* off-white */
  --card:#ffffff;
  --accent:#0b76d1;
  --danger:#c22b2b;
  --text:#052033;
  --muted:#6b7280;
  --radius:12px;
  --shadow: 0 8px 30px rgba(15,23,42,0.06);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
.container{max-width:1000px;margin:28px auto;padding:20px;}
header{display:flex;gap:14px;align-items:center;margin-bottom:18px;}
.logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#3ec7ff);color:white;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px;box-shadow:var(--shadow)}
h1{margin:0;font-size:20px}
.lead{margin:0;color:var(--muted);font-size:13px}

/* card */
.card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);display:grid;grid-template-columns:1fr 360px;gap:18px;min-height:640px;overflow:hidden;}
.chat{display:flex;flex-direction:column;gap:12px;}
.messages{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:12px}
.bubble{max-width:86%;padding:13px 14px;border-radius:12px;background:#f1f5f9;border:1px solid #e6eef7;line-height:1.45}
.bubble.bot{align-self:flex-start}
.bubble.user{align-self:flex-end;background:linear-gradient(180deg,#e6f6ff,#ffffff);border:1px solid rgba(11,118,209,0.08);color:#03223b}

/* options */
.options{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
.btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(11,118,209,0.12);background:white;color:var(--accent);font-weight:700;cursor:pointer}
.btn.secondary{border:1px solid rgba(0,0,0,0.06);color:var(--text);background:#fbfeff}
.btn.warn{background:linear-gradient(90deg,var(--danger),#ff706e);color:white;border:0}

/* panel */
.panel{background:linear-gradient(180deg,#ffffff,#fbfeff);border-radius:10px;padding:14px;display:flex;flex-direction:column;gap:12px;border:1px solid rgba(2,6,23,0.03)}
.panel h3{margin:0;font-size:16px}
.info{font-size:14px;color:var(--muted);line-height:1.45}

/* emergency */
.emergency{background:linear-gradient(90deg,var(--danger),#ff6b6b);padding:12px;border-radius:10px;color:white;font-weight:800;line-height:1.3;display:none}
.call{display:inline-block;padding:10px 12px;border-radius:10px;background:#04293b;color:white;text-decoration:none;font-weight:800}

/* floating call */
.floating{position:fixed;right:18px;bottom:18px;background:var(--danger);color:white;padding:12px 14px;border-radius:999px;font-weight:800;text-decoration:none;display:none;z-index:999}

/* footer */
.footer{font-size:13px;color:var(--muted);text-align:center;margin-top:12px}

/* responsive */
@media (max-width:980px){.card{grid-template-columns:1fr;min-height:760px}.panel{order:2}}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">UBS</div>
      <div>
        <h1>Assistente Virtual de Sa√∫de ‚Äî UBS</h1>
        <p class="lead">Triagem inicial autom√°tica ‚Äî escolha as op√ß√µes com bot√µes (sem digita√ß√£o).</p>
      </div>
    </header>

    <main class="card" role="main" aria-live="polite">
      <section class="chat" aria-label="Chat">
        <div id="messages" class="messages" aria-live="polite" aria-atomic="false"></div>
        <div id="options" class="options" aria-hidden="false"></div>
      </section>

      <aside class="panel" aria-label="Informa√ß√µes e contatos">
        <h3>Contatos e Endere√ßos</h3>
        <div class="info">
          <strong>SAMU:</strong> 192<br>
          <strong>Pronto Atendimento 24h ‚Äî</strong> Rua L-2, 190, Interlagos, Para√≠so do Tocantins<br>
          <strong>Hospital Regional ‚Äî</strong> Rua 03, Setor Aeroporto
        </div>

        <div>
          <h3>Como usar</h3>
          <div class="info">Selecione um tema com os bot√µes. O assistente far√° perguntas r√°pidas e lhe dar√° orienta√ß√µes. Em casos graves, ser√° exibido o bot√£o para ligar ao SAMU e o endere√ßo de refer√™ncia.</div>
        </div>

        <div id="panelEmergency" class="emergency" aria-hidden="true"></div>
        <div style="margin-top:auto">
          <a id="panelCall" class="call" href="tel:192" style="display:none" aria-hidden="true">üìû Ligar 192 (SAMU)</a>
        </div>
      </aside>
    </main>

    <div class="footer">Se for emerg√™ncia real, ligue para SAMU: <strong>192</strong></div>
  </div>

  <a id="floatingCall" class="floating" href="tel:192" aria-hidden="true">üìû Ligar 192</a>

<script>
/* utilities */
const messages = document.getElementById('messages');
const options = document.getElementById('options');
const panelEmergency = document.getElementById('panelEmergency');
const panelCall = document.getElementById('panelCall');
const floatingCall = document.getElementById('floatingCall');

function bot(text){ const d = document.createElement('div'); d.className='bubble bot'; d.innerHTML = text; messages.appendChild(d); messages.scrollTop = messages.scrollHeight; return d; }
function user(text){ const d = document.createElement('div'); d.className='bubble user'; d.innerHTML = '<strong>Voc√™:</strong> ' + text; messages.appendChild(d); messages.scrollTop = messages.scrollHeight; return d; }
function clearOptions(){ options.innerHTML=''; }
function setOptions(arr){ clearOptions(); if(!arr) return; arr.forEach(o=>{ const b = document.createElement('button'); b.className = o.style==='warn' ? 'btn warn' : (o.style==='secondary' ? 'btn secondary' : 'btn'); b.textContent = o.label; b.onclick = ()=> handle(o.id,o.label); options.appendChild(b); }); }
function showEmergency(html){ panelEmergency.style.display='block'; panelEmergency.innerHTML = html; panelEmergency.setAttribute('aria-hidden','false'); panelCall.style.display='inline-block'; panelCall.setAttribute('aria-hidden','false'); floatingCall.style.display='inline-block'; floatingCall.setAttribute('aria-hidden','false'); }
function hideEmergency(){ panelEmergency.style.display='none'; panelEmergency.setAttribute('aria-hidden','true'); panelCall.style.display='none'; panelCall.setAttribute('aria-hidden','true'); floatingCall.style.display='none'; floatingCall.setAttribute('aria-hidden','true'); }

/* Full script text (from user's provided roteiro) */
const SCRIPT = {
  greeting: `üëã Ol√°, seja bem-vindo(a)! Eu sou assistente virtual de sa√∫de.<br>Para come√ßar, me conta: voc√™ gostaria de falar sobre:`,
  kidneys: {
    intro: `Certo! Vou fazer algumas perguntinhas r√°pidas sobre problemas nos rins.`,
    q_pain: `Voc√™ est√° apresentando dor lombar intensa, em c√≥lica, que pode irradiar para abdome inferior ou regi√£o genital?`,
    no_pain: `Tudo bem! Caso apresente dor s√∫bita e forte na regi√£o lombar, procure atendimento m√©dico. Atualmente, n√£o h√° sinais de c√≥lica renal.`,
    consider: `Isso pode ser um quadro de c√≥lica renal por lit√≠ase urin√°ria (pedra nos rins). Antes de prosseguirmos, preciso saber: Voc√™ apresenta algum destes sinais de gravidade?`,
    signs_list: `<ul><li>Febre (&gt; 38¬∫C)</li><li>N√°useas ou v√¥mitos persistentes</li><li>Dificuldade ou impossibilidade de urinar</li><li>Sangue vis√≠vel na urina (hemat√∫ria macrosc√≥pica intensa)</li><li>Dor insuport√°vel que n√£o melhora com analg√©sicos</li></ul>`,
    emergency: `üö® Isso √© uma emerg√™ncia! Ligue imediatamente para o SAMU (192) ou v√° ao pronto-socorro mais pr√≥ximo (Pronto Atendimento 24 horas em Para√≠so do Tocantins: Rua L-2, 190, Interlagos). Risco de complica√ß√£o grave, como infec√ß√£o urin√°ria obstrutiva ou insufici√™ncia renal aguda.`,
    no_emergency_advice: `O quadro pode ser uma c√≥lica renal sem sinais de complica√ß√£o.<br><strong>Recomenda√ß√µes:</strong><ul><li>Beba bastante √°gua (se n√£o houver contraindica√ß√£o).</li><li>Use analg√©sicos simples conforme orienta√ß√£o m√©dica.</li><li>Procure atendimento m√©dico para confirmar o diagn√≥stico e realizar exames de imagem (ultrassom ou tomografia).</li><li>Retorne imediatamente ao pronto-socorro se surgirem febre, v√¥mitos persistentes, dificuldade para urinar ou dor que n√£o melhora.</li></ul>`,
    q_history: `Voc√™ j√° teve pedra nos rins antes?`,
    history_yes: `Entendi. Pessoas que j√° tiveram c√°lculos t√™m alto risco de recorr√™ncia. √â importante acompanhamento m√©dico regular, exames de imagem e ajustes na dieta.`,
    history_no: `Ok! Esse pode ser o seu primeiro epis√≥dio, mas ainda assim precisa de avalia√ß√£o m√©dica.`,
    q_urine_symptoms: `Voc√™ est√° sentindo dor ao urinar, vontade de urinar muitas vezes, sangue na urina ou febre?`,
    urine_yes: `Entendi. Esses sinais podem indicar algo que precisa de aten√ß√£o m√©dica. Se a dor for forte ou tiver sangue na urina, procure atendimento m√©dico o quanto antes. Quer que eu te mostre cuidados b√°sicos at√© chegar ao posto?`,
    urine_no: `√ìtimo. Se for apenas d√∫vida sobre sa√∫de dos rins, posso te dar dicas para preven√ß√£o: beber bastante √°gua, evitar excesso de sal e controlar press√£o e diabetes.`,
    basic_care: `<strong>Cuidados b√°sicos at√© chegar ao atendimento:</strong><ul><li>Mantenha a pessoa em posi√ß√£o confort√°vel.</li><li>Se houver n√°useas, ofere√ßa pequenas quantidades de l√≠quido se tolerado.</li><li>Evite dar anti-inflamat√≥rios fortes sem orienta√ß√£o m√©dica.</li><li>Se houver sangramento intenso ou dificuldade para urinar, procure o pronto-socorro imediatamente.</li></ul>`
  },

  diabetes: {
    intro: `Entendido! Vamos falar sobre diabetes e hipoglicemia.`,
    q_diagnosis: `Voc√™ j√° tem diagn√≥stico de diabetes?`,
    q_symptoms: `Est√° sentindo tontura, fraqueza, vis√£o emba√ßada ou muita sede?`,
    symptoms_may: `Esses sintomas podem indicar altera√ß√£o da glicose. Se estiver passando mal, v√° ao pronto atendimento.`,
    prevention_offer: `Sinais de alerta para procurar m√©dico: sede em excesso, urinar muito, perda de peso n√£o intencional e vis√£o borrada. Gostaria de dicas para preven√ß√£o da diabetes?`,
    prevention_yes_text: `Para prevenir diabetes tipo 2: manter alimenta√ß√£o equilibrada (frutas, verduras, cereais integrais), praticar pelo menos 150 minutos de atividade f√≠sica por semana, evitar tabagismo, reduzir √°lcool, dormir bem e controlar estresse. Fa√ßa check-ups regulares se tiver fatores de risco.`,
    hypo_intro: `Agora, sobre hipoglicemia:`,
    hypo_mild: `<strong>Hipoglicemia leve (50‚Äì70 mg/dL)</strong>: fome, tremores, suor frio, palpita√ß√µes.<br><strong>Tratamento (leve):</strong> tomar 15 g de carboidrato de r√°pida absor√ß√£o (ex.: 1 copo de √°gua com 1 colher de sopa de a√ß√∫car; 3 balinhas; 3 sach√™s de mel; meio copo de suco). Espere 15 minutos e reavalie.`,
    hypo_mod_severe: `<strong>Hipoglicemia moderada/grave (&lt;50 mg/dL)</strong>: tontura, fraqueza, vis√£o emba√ßada, dor de cabe√ßa, irrita√ß√£o, perda de consci√™ncia poss√≠vel.<br><strong>Tratamento (grave):</strong> tomar 30 g de carboidrato de r√°pida absor√ß√£o (ex.: 1 copo de √°gua com 2 colheres de sopa de a√ß√∫car; 6 balinhas; 6 sach√™s de mel; 1 copo de suco). Espere 15 minutos e reavalie. Se n√£o melhorar, procure ajuda m√©dica imediatamente. Se inconsciente, √© emerg√™ncia: ligar 192 e, se dispon√≠vel, aplicar glucagon conforme protocolo.`
  },


const SCRIPT = {
  venom: {
    intro: `Urg√™ncia e Emerg√™ncia ‚Äî Animais pe√ßonhentos.`,
    q_snake: `Voc√™ sofreu acidente envolvendo cobra/serpente?`,
    snake_identify: ``,
    snake_classify: `Classifique o acidente: leve, moderado ou grave.`,
    snake_severity_text: `<strong>Sinais de alarme (qualquer animal pe√ßonhento):</strong><ul><li>Incha√ßo intenso</li><li>Bolhas</li><li>Sangramento</li><li>Hipotens√£o / choque</li><li>Dificuldade respirat√≥ria</li><li>Convuls√µes</li></ul>`,
    snake_not_identified: `Se n√£o identificar o animal, mantenha observa√ß√£o. Se houver dor intensa, incha√ßo ou sinais sist√™micos, procure atendimento.`,
    scorpion_intro: `Voc√™ sofreu acidente envolvendo escorpi√£o?`,
    scorpion_class: `Classifique o acidente em leve, moderado ou grave.`,
    scorpion_info: `Nos acidentes leves: dor local (geralmente em extremidades inferiores). Nos moderados: sudorese, n√°useas, v√¥mitos, agita√ß√£o. Nos graves: saliva√ß√£o excessiva, arritmia, dificuldade respirat√≥ria, altera√ß√£o neurol√≥gica.`
  }
};

/* Flow nodes (buttons only) */
const NODES = {
  start: {
    bot: SCRIPT.greeting,
    options: [
      {id:'kid_intro', label:'1Ô∏è‚É£ Problemas nos rins (Lit√≠ase)'},
      {id:'dia_intro', label:'2Ô∏è‚É£ Diabetes (Hipoglicemia)'},
      {id:'ven_intro', label:'3Ô∏è‚É£ Urg√™ncia / Animais pe√ßonhentos'}
    ]
  },

  /* Kidneys */
  kid_intro: {
    bot: SCRIPT.kidneys.intro + '<br><br>' + SCRIPT.kidneys.q_pain,
    options: [{id:'kid_pain_no', label:'N√£o'}, {id:'kid_pain_yes', label:'Sim'}]
  },
  kid_pain_no: {
    bot: SCRIPT.kidneys.no_pain,
    options: [{id:'kid_back_to_start', label:'Voltar ao in√≠cio'}, {id:'kid_more', label:'Dicas de preven√ß√£o'}]
  },
  kid_more: {
    bot: '<strong>Dicas de preven√ß√£o:</strong><br>- Beber muita √°gua diariamente (meta individual).<br>- Evitar excesso de sal e grande ingest√£o de prote√≠nas animais.<br>- Controlar press√£o arterial e glicemia.<br>- Buscar reavalia√ß√£o com equipe de sa√∫de.',
    options:[{id:'start',label:'Voltar ao in√≠cio'}]
  },
  kid_pain_yes: {
    bot: SCRIPT.kidneys.consider + '<br>' + SCRIPT.kidneys.signs_list,
    options: [{id:'kid_signs_yes', label:'Apresento um ou mais sinais'}, {id:'kid_signs_no', label:'N√£o apresento sinais'}]
  },
  kid_signs_yes: {
    bot: SCRIPT.kidneys.emergency,
    emergency:true,
    options: [{id:'kid_em_next', label:'Entendi ‚Äî e agora?'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  kid_em_next: {
    bot: SCRIPT.kidneys.emergency + '<br><br><strong>Endere√ßos de refer√™ncia:</strong><br>Pronto Atendimento 24h ‚Äî Rua L-2, 190, Interlagos, Para√≠so do Tocantins<br>Hospital Regional ‚Äî Rua 03, Setor Aeroporto',
    emergency:true,
    options: [{id:'kid_followup', label:'Recomenda√ß√µes at√© chegar'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  kid_signs_no: {
    bot: SCRIPT.kidneys.no_emergency_advice,
    options: [{id:'kid_history', label:'J√° tive pedra nos rins'}, {id:'kid_first', label:'Primeira vez'}, {id:'kid_urine_symp_q', label:'Tenho sintomas urin√°rios'}]
  },
  kid_history: {
    bot: SCRIPT.kidneys.history_yes,
    options: [{id:'kid_followup', label:'Recomenda√ß√µes'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  kid_first: {
    bot: SCRIPT.kidneys.history_no,
    options: [{id:'kid_followup', label:'Recomenda√ß√µes'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  kid_urine_symp_q: {
    bot: SCRIPT.kidneys.q_urine_symptoms,
    options: [{id:'kid_urine_yes', label:'Sim'}, {id:'kid_urine_no', label:'N√£o'}]
  },
  kid_urine_yes: {
    bot: SCRIPT.kidneys.urine_yes,
    options: [{id:'kid_show_basic', label:'Mostrar cuidados b√°sicos'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  kid_show_basic: {
    bot: SCRIPT.kidneys.basic_care,
    options: [{id:'kid_followup', label:'Recomenda√ß√µes e seguimento'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  kid_urine_no: {
    bot: SCRIPT.kidneys.urine_no,
    options: [{id:'kid_followup', label:'Dicas de preven√ß√£o'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  kid_followup: {
    bot: '<strong>Recomenda√ß√µes e seguimento:</strong><br>- Procurar avalia√ß√£o m√©dica para exames (urina, creatinina, imagem).<br>- Hidrata√ß√£o adequada conforme orienta√ß√£o m√©dica.<br>- Revis√£o de dieta e, se indicado, estudo metab√≥lico para preven√ß√£o de recidiva.',
    options: [{id:'start', label:'Voltar ao in√≠cio'}]
  },

  /* Diabetes */
  dia_intro: {
    bot: SCRIPT.diabetes.intro + '<br><br>' + SCRIPT.diabetes.q_diagnosis,
    options: [{id:'dia_yes', label:'Sim'}, {id:'dia_no', label:'N√£o'}]
  },
  dia_yes: {
    bot: SCRIPT.diabetes.q_symptoms,
    options: [{id:'dia_sym_yes', label:'Sim'}, {id:'dia_sym_no', label:'N√£o'}]
  },
  dia_sym_yes: {
    bot: SCRIPT.diabetes.symptoms_may,
    options: [{id:'dia_hypo_info', label:'Explicar hipoglicemia'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  dia_hypo_info: {
    bot: SCRIPT.diabetes.hypo_mild + '<br><br>' + SCRIPT.diabetes.hypo_mod_severe,
    options: [{id:'dia_prevention', label:'Preven√ß√£o e rotina'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  dia_sym_no: {
    bot: 'Continue se cuidando! Lembre-se de manter alimenta√ß√£o equilibrada, tomar a medica√ß√£o no hor√°rio e praticar atividade f√≠sica regularmente.',
    options: [{id:'dia_prevention', label:'Dicas de preven√ß√£o'}, {id:'start', label:'Voltar ao in√≠cio'}]
  },
  dia_no: {
    bot: SCRIPT.diabetes.prevention_offer,
    options: [{id:'dia_prevent_yes', label:'Sim, quero dicas'}, {id:'start', label:'N√£o'}]
  },
  dia_prevent_yes: {
    bot: SCRIPT.diabetes.prevention_yes_text,
    options: [{id:'start', label:'Voltar ao in√≠cio'}]
  },
  dia_prevention: {
    bot: '<strong>Preven√ß√£o e rotina:</strong><br>' + SCRIPT.diabetes.prevention_yes_text + '<br><br><strong>Aten√ß√£o:</strong> se houver sinais de hipoglicemia grave (confus√£o, perda de consci√™ncia), ligue 192 imediatamente.',
    options: [{id:'start', label:'Voltar ao in√≠cio'}]
  },

  /* Venom */
const FLOW = {
  ven_intro: {
    bot: SCRIPT.venom.intro + '<br><br>' + SCRIPT.venom.q_snake,
    options: [
      { id: 'ven_snake_yes', label: 'Sim' },
      { id: 'ven_snake_no', label: 'N√£o' }
    ]
  },

  ven_snake_yes: {
    bot: SCRIPT.venom.snake_identify + '<br><br>Voc√™ consegue identificar se o animal √© pe√ßonhento?',
    options: [
      { id: 'ven_identify_yes', label: 'Sim' },
      { id: 'ven_identify_no', label: 'N√£o' }
    ]
  },

  ven_identify_yes: {
    bot: 'Identifique caracter√≠sticas (se poss√≠vel): denti√ß√£o, pupilas, fosseta loreal, cauda lisa, escamas eri√ßadas, guizo.<br><br>' +
         SCRIPT.venom.snake_classify,
    options: [
      { id: 'ven_class_grave', label: 'Grave' },
      { id: 'ven_class_mod', label: 'Moderado' },
      { id: 'ven_class_mild', label: 'Leve' },
      { id: 'start', label: 'N√£o sei' }
    ]
  },

  ven_identify_no: {
    bot: SCRIPT.venom.snake_not_identified,
    options: [
      { id: 'start', label: 'Voltar ao in√≠cio' },
      { id: 'ven_class_symptoms', label: 'Tenho sintomas ‚Äî avaliar' }
    ]
  },

  // ‚úÖ NOVA RESPOSTA CORRIGIDA:
  ven_class_symptoms: {
    bot: `Se houver dor intensa, incha√ßo ou sinais sist√™micos (sudorese, v√¥mitos persistentes, saliva√ß√£o excessiva, agita√ß√£o, arritmia, dificuldade respirat√≥ria e altera√ß√µes neurol√≥gicas), procure atendimento pela SAMU 192 ou Pronto Atendimento 24h (Rua L-2, 190, Interlagos).`,
    emergency: true,
    options: [{ id: 'start', label: 'Voltar ao in√≠cio' }]
  },

  ven_class_grave: {
    bot: 'üö®üö®üö® Isso √© uma emerg√™ncia! ' +
         SCRIPT.venom.snake_severity_text +
         '<br><br>Procure atendimento IMEDIATO: SAMU 192 ou Pronto Atendimento 24h ‚Äî Rua L-2, 190, Interlagos.',
    emergency: true,
    options: [{ id: 'start', label: 'Voltar ao in√≠cio' }]
  },

  ven_class_mod: {
    bot: 'üö®üö® Isso √© uma emerg√™ncia! ' +
         SCRIPT.venom.snake_severity_text +
         '<br><br>Procure atendimento urgente: SAMU 192 ou Pronto Atendimento 24h ‚Äî Rua L-2, 190, Interlagos.',
    emergency: true,
    options: [{ id: 'start', label: 'Voltar ao in√≠cio' }]
  },

  ven_class_mild: {
    bot: 'üö® Isso √© uma urg√™ncia. ' +
         SCRIPT.venom.snake_severity_text +
         '<br><br>Procure o pronto-socorro mais pr√≥ximo: Pronto Atendimento 24h ‚Äî Rua L-2, 190, Interlagos.',
    emergency: true,
    options: [{ id: 'start', label: 'Voltar ao in√≠cio' }]
  }
};

/* handler */
function render(nodeId){
  const node = NODES[nodeId];
  if(!node) return;
  if(node.bot) bot(node.bot);
  if(node.emergency){
    showEmergency('üö® EMERG√äNCIA ‚Äî Ligue 192 ou dirija-se ao pronto-socorro imediatamente.<br><br><strong>Endere√ßos:</strong><br>Pronto Atendimento 24h ‚Äî Rua L-2, 190, Interlagos, Para√≠so do Tocantins<br>Hospital Regional ‚Äî Rua 03, Setor Aeroporto');
    bot('üö® <strong>Emerg√™ncia:</strong> ligue 192 ou dirija-se ao pronto-socorro agora.<br><a href="tel:192" class="btn warn" style="display:inline-block;margin-top:8px;text-decoration:none">üìû Ligar 192 (SAMU)</a>');
  } else {
    hideEmergency();
  }
  setOptions(node.options);
}

/* entry */
function start(){
  messages.innerHTML='';
  hideEmergency();
  bot(SCRIPT.greeting);
  setOptions(NODES.start.options);
}
function setOptions(arr){ options.innerHTML=''; if(!arr) return; arr.forEach(o=>{ const b=document.createElement('button'); b.className = 'btn'; b.textContent = o.label; b.onclick = ()=>{ user(o.label); render(o.id); }; options.appendChild(b); }); messages.scrollTop = messages.scrollHeight; }
function handle(id,label){ user(label); render(id); }

/* show/hide emergency */
function showEmergency(html){ panelEmergency.style.display='block'; panelEmergency.innerHTML = html; panelEmergency.setAttribute('aria-hidden','false'); panelCall.style.display='inline-block'; panelCall.setAttribute('aria-hidden','false'); floatingCall.style.display='inline-block'; floatingCall.setAttribute('aria-hidden','false'); }
function hideEmergency(){ panelEmergency.style.display='none'; panelCall.style.display='none'; floatingCall.style.display='none'; panelEmergency.setAttribute('aria-hidden','true'); panelCall.setAttribute('aria-hidden','true'); floatingCall.setAttribute('aria-hidden','true'); }

/* start */
start();
</script>
</body>
</html>
